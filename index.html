<html>
    <head>
        <title>Open Api Test</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <meta name="format-detection" content="telephone=no">
        <style type="text/css">
        *{margin: 0;padding: 0}
        .container{
        	margin: 200px 20px 20px 20px
        }
        .api{
        	display: block;
        	height: 30px;
        	width: 100%;
        	text-align: center;
        	background-color: #fefefe;
        	margin-bottom: 10px;
        }
        </style>
    </head>
    <body>
		<div id="container" class="container">
    </body>
<script src="./Native.debug.js"></script>
<script src="./Native.js"></script>
<script type="text/javascript">
;(function () {
	var container = document.getElementById('container');
	var api = NativeApi.invoke;

	function addButton(cmdName, func) {

	    var btn = document.createElement('button');
	    btn.setAttribute('class', 'api');
	    btn.innerHTML = cmdName;
	    btn.onclick = function(){
	        try{
	            func();
	        }catch(e){
	            throw e;
	        }
	    };
	    container.appendChild(btn);
	}

	var config_status = 0;

	addButton("错误的appid", function() {
		console.log("test case 错误的appid + 正确的url");
		api("config", {
			appid: "101490553",
			permission: function (code) {
				console.log("test pass");
				config_status = 1;
				alert("permission - " + code);
			},
			success: function (res) {
				console.log("test fail");
				config_status = 2;
				alert("success - " + JSON.stringify(res));
			}
		});
	});

	addButton("错误的url", function() {
		location.href = "test2.html";
	});

	addButton('config', function() {
		console.log("test case 正确的appid + 正确的url");
		api("config", {
			appid: "101490554",
			permission: function (code) {
				console.log("test fail");
				config_status = 1;
				alert("permission - " + code);
			},
			success: function (res) {
				console.log("test pass");
				config_status = 2;
				alert("success - " + JSON.stringify(res));
			}
		});
	});

	addButton('getCity', function() {
		if (config_status == 0) {
			console.log("test case 不调config直接调getCity");
		} else if (config_status == 1) {
			console.log("test case 调用config失败再调getCity");
		} else if (config_status == 2) {
			console.log("test case 调用config成功再调getCity");
		}
		api("getCity", {
			permission: function (code) {
				alert("permission - " + code);
				if (config_status == 0 && code == 10) {
					console.log("test pass");
				} else if (config_status == 1 && code == 10) {
					console.log("test pass");
				} else {
					console.log("test fail");
				}
			},
			success: function (res) {
				if (config_status == 2) {
					console.log("test pass");
				} else {
					console.log("test fail");
				}
				alert("success - " + JSON.stringify(res));
			},
			failure: function (code, msg) {
				console.log("test fail");
				alert("failure - [" + code + "] " + msg);
			}
		});
	});

	addButton("错误的协议格式", function() {
		console.log("test case 非法的协议");
		var iframe = document.createElement("iframe");
		document.body.appendChild(iframe);
		iframe.src = "nativeapi://abab?ccc#ddd";
	});

	addButton("jsbridge协议", function() {
		console.log("test case jsbridge协议不会触发权限校验逻辑");
		var iframe = document.createElement("iframe");
		document.body.appendChild(iframe);
		iframe.src = "jsbridge://ui/showTips?p=%7B%22text%22%3A%22hahahaha%22%2C%22iconMode%22%3A2%7D#0";
	});

	addButton('login', function() {
		api("login", {
			success: function (res) {
				alert("success - " + JSON.stringify(res));
			},
			failure: function (code, msg) {
				alert("fail code" + code + " - " + msg);
			}
		});
	});
	
	// addButton('setShareInfo', function() {
	// 	api('setShareInfo', {
	// 		'title': 'title',
	// 		'share_url': location.origin + '/share',
	// 		'desc': 'desc',
	// 		'image_url': 'https://assets-cdn.github.com/images/icons/emoji/unicode/1f4d7.png',
	// 		'success': function() { alert('success'); }
	// 	});
	// });
	
	// function onActionClick() {
	// 	api('showActionSheet', {
	// 		'itemList': ['修改昵称', '修改个性签名'],
	// 		'cancelText': '取消',
	// 		'success': function(res) {
	// 			alert(JSON.stringify(res));
	// 		}
	// 	});
	// }

	// addButton('setShareInfo', function() {
	// 	api('setActionButton', {
	// 		'title': '编辑',
	// 		'iconID': 1,
	// 		'success': function() { alert('success'); },
	// 		'trigger': onActionClick
	// 	});
	// });

})();
</script>
</html>